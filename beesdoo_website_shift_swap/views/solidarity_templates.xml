<odoo>
  <data>

      <!-- Solidarity general status and offer button -->
      <template
            id="solidarity_info"
            name="solidarity info"
            inherit_id="beesdoo_website_shift.my_shift_regular_worker"
        >
        <xpath expr="//div[@class='col-12 col-lg-4 text-justify']" position="inside">
            <h2>Solidarity shifts status</h2>
            <p>
              <label class="font-weight-bold">Counter:</label>
              <t
                        t-esc="request.env['res.company']._company_default_get().solidarity_counter()"
                    />
            </p>
            <div>
              <a class="btn btn-primary" href="/my/shift/solidarity/offer">
                Offer a solidarity shift
              </a>
            </div>
        </xpath>
      </template>

      <!-- Help text for selection among underpopulated shifts -->
      <template
            id="help_text_underpopulated_solidarity_offer"
            name="Help text underpopulated solidarity offer"
        >
        <div class="alert alert-info">
          <strong>Info!</strong>
          On this page you can choose to subscribe to a shift that is
          underpopulated, as a solidarity shift. If you select one of them, you
          will have to attend it or to cancel it soon enough, via the "My shifts"
          page. If you cannot attend any of those on this list, please click on
          the button at the bottom of the page to see all available shifts.
        </div>
      </template>

      <!-- Help text for selection among all shifts -->
      <template
            id="help_text_all_shifts_solidarity_offer"
            name="Help text all shifts solidarity offer"
        >
        <div class="alert alert-info">
          <strong>Info!</strong>
          On this page you can choose to subscribe to a shift as a solidarity
          shift. If you select one of them, you will have to attend it or to
          cancel it soon enough, via the "My shifts" page.
        </div>
      </template>

      <!-- Display error message if can't offer solidarity shift -->
      <template
            id="website_shift_swap_offer_solidarity_impossible"
            name="Error message if can't offer solidarity shift"
        >
        <t t-call="portal.portal_layout">
          <t t-set="no_breadcrumbs" t-value="True" />
          <div class="container mt16">
            <div class="row">
              <div class="col text-center">
                <div class="alert alert-warning">
                  <strong>Warning !</strong>
                  Your current status does not allow you to offer solidarity shifts.
                </div>
                <a class="btn btn-primary" href="/my/shift">Go back</a>
              </div>
            </div>
          </div>
        </t>
      </template>

      <!-- Display error message if can't cancel solidarity offer -->
      <template
            id="website_shift_swap_cancel_solidarity_offer_impossible"
            name="Error message if can't cancel solidarity offer"
        >
        <t t-call="portal.portal_layout">
          <t t-set="no_breadcrumbs" t-value="True" />
          <div class="container mt16">
            <div class="row">
              <div class="col text-center">
                <div class="alert alert-warning">
                  <strong>Warning !</strong>
                  Your can't cancel this solidarity shift, because it is too close in time.
                </div>
                <a class="btn btn-primary" href="/my/shift">Go back</a>
              </div>
            </div>
          </div>
        </t>
      </template>

      <!-- Template display underpopulated shift for solidarity-->
      <template
            id="website_shift_swap_tmpl_dated_solidarity"
            name="Next shifts for solidarity"
        >
        <t t-if="all_shifts">
          <h2>
            Select a shift
          </h2>
        </t>
        <t t-else="">
          <h2>
            Select an underpopulated shift
          </h2>
        </t>
        <t t-foreach="shifts" t-as="tmpl_dated">
          <div t-att-class="'card mb-4 %s' % highlight_class">
            <div t-att-class="'card-header %s clearfix' % highlight_header_class">
              <div class="pull-left">
                  <p>
                    <t t-esc="tmpl_dated.date.strftime('%A %d %b, %Y')" />
                    <t t-esc="'|'" />
                    <t
                                    t-esc="str(datetime.timedelta(hours=tmpl_dated.template_id.start_time)).rsplit(':', 1)[0]"
                                />
                    -
                    <t
                                    t-esc="str(datetime.timedelta(hours=tmpl_dated.template_id.end_time)).rsplit(':', 1)[0]"
                                />
                    <br />
                    <t t-esc="tmpl_dated.template_id.task_type_id.name" />
                  </p>
              </div>
            </div>
            <div>
              <div class="card-body clearfix">
                <a
                                class="btn btn-success btn-sm"
                                t-att-href="'/my/shift/solidarity/offer/select/%i/%s' % (tmpl_dated.template_id,tmpl_dated.date)"
                            >Subscribe to this Shift</a>
              </div>
            </div>
          </div>
        </t>
        <t t-if="not all_shifts">
          <p>
            <a
                        class="btn btn-secondary btn-dark btn-block"
                        t-att-href="'/my/shift/solidarity/offer/all'"
                    >No shifts suits me</a>
          </p>
        </t>
      </template>

      <!-- Solidarity shift selection page -->
      <!-- Template for page /my/shift/solidarity/offer and /my/shift/solidarity/offer/all -->
      <template
            id="website_shift_swap_select_solidarity"
            name="Select a shift for solidarity"
        >
        <t t-call="portal.portal_layout">
          <t t-set="no_breadcrumbs" t-value="True" />
          <div class="container mt16">
            <div class="row">
              <div class="col text-center">
                <h1>
                  Offer a solidarity shift
                </h1>
              </div>
            </div>
            <div class="row">
              <div class="col-12 col-lg-8">
                <t
                                t-call="beesdoo_website_shift_swap.website_shift_swap_tmpl_dated_solidarity"
                            />
              </div>
              <div class="col-12 col-lg-4 text-justify">
                <t t-call="beesdoo_website_shift.help_text_title" />
                <t t-if="not all_shifts">
                  <t
                                    t-call="beesdoo_website_shift_swap.help_text_underpopulated_solidarity_offer"
                                />
                </t>
                <t t-else="">
                  <t
                                    t-call="beesdoo_website_shift_swap.help_text_all_shifts_solidarity_offer"
                                />
                </t>
              </div>
            </div>
          </div>
        </t>
      </template>

      <!-- Template for page /my/shift/solidarity/request -->
      <template
            id="website_shift_swap_request_solidarity"
            name="Request a solidarity shift"
        >
        <t t-call="portal.portal_layout">
          <t t-set="no_breadcrumbs" t-value="True" />
          <div class="container mt16">
            <div class="row">
              <div class="col text-center">
                <h1 class="text-center">Request a solidarity shift</h1>
              </div>
            </div>
            <div class="row">
              <div class="col-12 col-lg-6 m-auto text-justify">
                <t
                                t-call="beesdoo_website_shift_swap.website_shift_swap_request_solidarity_form"
                            />
              </div>
            </div>
          </div>
        </t>
      </template>

      <!-- Form for a solidarity shift request -->
      <template
            id="website_shift_swap_request_solidarity_form"
            name="Form to request a solidarity shift"
        >
        <form method="POST">
          <div class="form-group">
            <label class="font-weight-bold">Non realisable shift :</label>
            <t t-esc="tmpl_dated.date.strftime('%A %d %b, %Y')" />
            <t t-esc="'|'" />
            <t
                        t-esc="str(datetime.timedelta(hours=tmpl_dated.template_id.start_time)).rsplit(':', 1)[0]"
                    />
            -
            <t
                        t-esc="str(datetime.timedelta(hours=tmpl_dated.template_id.end_time)).rsplit(':', 1)[0]"
                    />
          </div>
          <div class="form-group">
            <label for="reason">Reason :</label>
            <textarea class="form-control" name="reason" rows="5" />
          </div>
          <button type="submit" class="btn btn-success">Validate request</button>
          <a href="/my/shift" class="btn btn-danger">Cancel</a>
          <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />
        </form>
      </template>

      <!-- Display solidarity requests and their status -->
      <template
            id="my_solidarity_request_template"
            name="My solidarity request template"
        >
        <h2>
          Solidarity requests
        </h2>
        <t t-if="solidarity_requests">
          <table class="table table-hover text-justify">
            <thead class="thead-dark">
              <tr>
                <th class="col-3">Non realisable shift</th>
                <th class="col-7">Reason</th>
                <th class="col-2">Request status</th>
              </tr>
            </thead>
            <tbody>
              <t t-foreach="solidarity_requests" t-as="request">
                <tr>
                  <td>
                    <t t-esc="request.tmpl_dated_id.date.strftime('%A %d %b, %Y')" />
                    |
                    <t
                                        t-esc="str(datetime.timedelta(hours=request.tmpl_dated_id.template_id.start_time)).rsplit(':', 1)[0]"
                                    />
                    -
                    <t
                                        t-esc="str(datetime.timedelta(hours=request.tmpl_dated_id.template_id.end_time)).rsplit(':', 1)[0]"
                                    />
                  </td>
                  <td>
                    <t t-esc="request.reason" />
                  </td>
                  <td>
                    <t
                                        t-esc="dict(request.fields_get(allfields=['state'])['state']['selection'])[request.state]"
                                    />
                    <t
                                        t-if="request.state == 'validated' and request.tmpl_dated_id.date > now"
                                    >
                      <br />
                      <a
                                            class="btn btn-danger btn-sm"
                                            t-att-href="'/my/shift/solidarity/request/cancel/%i' % request.id"
                                        >
                        Cancel request
                      </a>
                    </t>
                  </td>
                </tr>
              </t>
            </tbody>
          </table>
        </t>
        <t t-else="">
          <div class="alert alert-info">
            <strong>Info!</strong>
            You don't have any solidarity request.
          </div>
        </t>
      </template>

  </data>
</odoo>

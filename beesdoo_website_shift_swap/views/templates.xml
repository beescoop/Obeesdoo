<odoo>
    <data>
        <!-- My request menu item -->
        <template id="my_request_link" name="Request Link to frontend portal" inherit_id="portal.frontend_layout">
          <xpath expr="//a[@id='o_logout']" position="before">
            <div t-if="user_id.partner_id.working_mode == 'regular'">
              <a href="/my/request" class="dropdown-item" role="menuitem" >My Requests</a>
            </div>
          </xpath>
        </template>

        <!-- Reusable templates -->
        <template id="swap_shift_title" name="Swap Shift Title">
          <h1>
            Swap Your Shift
          </h1>
        </template>

        <template id="no_shifts_suits_me_button" name="No shifts suits me">
          <a class="btn btn-secondary btn-dark btn-block" t-att-href="'/my/shift/possible/shift'">No shifts suits me</a>
        </template>

        <!-- help text for underpopulated swap-->
        <template id="help_text_swap_underpopulated_common" name="Help Text Swap Underpopulated Common">
          <div class="alert alert-info">
            <strong>Info!</strong>
            The Shift that you want to swap is before the next 28 days.
            To accelerate the process, we propose you to subscribe to an
            underpopulated timeslot. It arranges the both of us and you
            don't need to wait for an other cooperator.
            However, if none shifts suits you, you can skip this step and
            propose your own exchange.
            (see link at the end of the page)
          </div>
        </template>

        <!-- Add link to swap shift -->
        <template
          id="website_shift_swap_button"
          name="shift swap button"
          inherit_id="beesdoo_website_shift.my_shift_next_shifts">
          <xpath expr="//div[@class='card-body clearfix']" position="inside">
            <p>
              <a t-att-href="'/my/shift/swaping/%i/%s' % (shift.task_template_id,shift.start_time)">Swap Shift</a>
            </p>
          </xpath>
        </template>

        <!-- Template display underpopulated shift -->
        <template
            id="website_shift_swap_next_underpopulated_timeslot"
            name="Shift Swap Next Underpopulated Page" >
            <h2>
            Swap Your Shift To Underpopulated Shift
            </h2>
            <t t-foreach="underpopulated_shift" t-as="timeslot">
                <div t-att-class="'card mb-4 %s' % highlight_class">
                    <div t-att-class="'card-header %s clearfix' % highlight_header_class">
                        <div class="pull-left">
                            <p>
                              <t t-esc="timeslot.date.strftime('%B %d, %Y')"/>
                              <t t-esc="'|'"/>
                              <t t-esc="str(datetime.timedelta(hours=timeslot.template_id.start_time)).rsplit(':', 1)[0]"/>
                              -
                              <t t-esc="str(datetime.timedelta(hours=timeslot.template_id.end_time)).rsplit(':', 1)[0]"/>
                            </p>
                        </div>
                    </div>
                    <div>
                        <div class="card-body clearfix">
                            <a t-att-href="'/my/shift/underpopulated/swap/subscribe/%i/%s' % (timeslot.template_id,timeslot.date)">Subscribe to this Shift</a>
                        </div>
                    </div>
                </div>
            </t>
            <p>
              <t t-call="beesdoo_website_shift_swap.no_shifts_suits_me_button"/>
            </p>
        </template>

        <template id="website_shift_swap_summary" name="Swap Summary">
          <h2>
            Swap Summary :
          </h2>
          <br/>
          <p>
            <label class="font-weight-bold">Exchanged Shift :</label>
            <t t-esc="exchanged_timeslot.date.strftime('%B %d, %Y')"/>
            <t t-esc="'|'"/>
            <t t-esc="str(datetime.timedelta(hours=exchanged_timeslot.template_id.start_time)).rsplit(':', 1)[0]"/>
            -
            <t t-esc="str(datetime.timedelta(hours=exchanged_timeslot.template_id.end_time)).rsplit(':', 1)[0]"/>
          </p>
        </template>

        <template id="website_shift_swap_underpopulated_timeslot" name="Shift Swap Underpopulated Page">
            <t t-call="portal.portal_layout">
                <t t-set="no_breadcrumbs" t-value="True" />

                <div class="container mt16">
                    <div class="row">
                        <div class="col text-center">
                            <t t-call="beesdoo_website_shift_swap.swap_shift_title" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 m-auto text-justify">
                            <t t-call="beesdoo_website_shift_swap.website_shift_swap_summary"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-8">
                            <t t-call="beesdoo_website_shift_swap.website_shift_swap_next_underpopulated_timeslot" />
                        </div>
                        <div class="col-12 col-lg-4 text-justify">
                            <t t-call="beesdoo_website_shift.help_text_title" />
                            <t t-call="beesdoo_website_shift_swap.help_text_swap_underpopulated_common" />
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <!-- display timeslot that match with my exchanged timeslot -->
        <template
        id="beesdoo_website_shift_swap.no_shift_match_explanation"
        name="No shift Match Explanation">
            <div class="alert alert-info">
            <strong>Info!</strong>
            There aren't any cooperator that propose to swap his/her shift with the one
            that you try to exchange.
            To create your own exchange, please click on the link below.
        </div>

        </template>

        <template id="website_shift_swap_my_possible_match" name="Shift Swap My Possible Match Page">
          <title>Possible Match</title>
          <div t-if="not possible_matches">
            <t t-call="beesdoo_website_shift_swap.no_shift_match_explanation" />
          </div>
          <div t-else="">
            <label class="font-weight-bold">Shifts available for exchange :</label>
            <t t-foreach="possible_matches" t-as="match">
              <p>
                <t t-esc="match.exchanged_timeslot_id.date.strftime('%B %d, %Y')"/>
                <t t-esc="'|'"/>
                <t t-esc="str(datetime.timedelta(hours=match.exchanged_timeslot_id.template_id.start_time)).rsplit(':', 1)[0]"/>
                -
                <t t-esc="str(datetime.timedelta(hours=match.exchanged_timeslot_id.template_id.end_time)).rsplit(':', 1)[0]"/>
                <a class="btn btn-success btn-sm" t-att-href="'/my/shift/validate/matching_request/%i' % (match.id)">Accept Exchange</a>
              </p>
            </t>
          </div>
          <p>
            <t t-call="beesdoo_website_shift_swap.no_shifts_suits_me_button"/>
          </p>
        </template>

        <template id="website_shift_swap_possible_match" name="Shift Swap possible Match Page">
          <t t-call="portal.portal_layout">
            <t t-set="no_breadcrumbs" t-value="True" />
            <div class="container mt16">
              <div class="row">
                <div class="col text-center">
                  <t t-call="beesdoo_website_shift_swap.swap_shift_title" />
                </div>
              </div>
              <div class="row">
                <div class="col-12 col-lg-6 m-auto text-justify">
                  <t t-call="beesdoo_website_shift_swap.website_shift_swap_summary"/>
                </div>
              </div>
              <div class="row">
                <div class="col-12 col-lg-6 m-auto text-justify">
                  <t t-call="beesdoo_website_shift_swap.website_shift_swap_my_possible_match"/>
                </div>
              </div>
            </div>
          </t>
        </template>


        <!-- display possible timeslot to create an exchange request -->
        <template
            id="website_shift_swap_next_possible_timeslot"
            name="Shift Swap possible Next timeslot Page">
            <title>Possible timeslot</title>
            <form method="post">
                <t t-set="index" t-value="0"/>
                <t t-foreach="possible_timeslot" t-as="timeslot">
                    <p>
                        <input type="checkbox" name="timeslot_index" multiple="multiple" t-att-value="index">
                            <t t-esc="timeslot.template_id.name"/>
                            <t t-esc="timeslot.date"/></input>
                        <t t-set="index" t-value="index + 1"/>
                    </p>
                </t>
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <p>
                    <input type="submit" value="Validate the exchange with this Shifts"></input>
                </p>
            </form>
        </template>

        <template id="website_shift_swap_possible_timeslot" name="Shift Swap possible timeslot Page">
            <t t-call="portal.portal_layout">
                <t t-set="no_breadcrumbs" t-value="True" />

                <div class="container mt16">
                    <div class="row">
                        <div class="col text-center">
                            <t t-call="beesdoo_website_shift_swap.swap_shift_title" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-lg-6 m-auto text-justify">
                            <t t-call="beesdoo_website_shift_swap.website_shift_swap_summary"/>
                        </div>
                    </div>
                    <div class="row">
                        <t t-call="beesdoo_website_shift_swap.website_shift_swap_next_possible_timeslot" />
                    </div>
                </div>
            </t>
        </template>


        <!-- display request that match with my request -->
        <template id="website_shift_swap_matching_request">
            <title>My Match</title>
            <t t-foreach="match" t-as="match">
                <p><t t-esc="match"/></p>
            </t>
        </template>

        <!-- display my request and (if got match) match-->
        <template
        id="my_request_template"
        name="My Request Template">
          <h1>
            My shift exchange requests
          </h1>
          <table class="table table-hover">
            <thead class="thead-dark">
              <tr>
                <th>Unwanted shifts</th>
                <th>My exchange offers</th>
                <th>Exchange status</th>
              </tr>
            </thead>
            <tbody>
              <t t-foreach="my_requests" t-as="request">
                <tr>
                  <td>
                    <t t-esc="request['my_requests'].exchanged_timeslot_id.date.strftime('%B %d, %Y')"/>
                    <t t-esc="'|'"/>
                    <t t-esc="str(datetime.timedelta(hours=request['my_requests'].exchanged_timeslot_id.template_id.start_time)).rsplit(':', 1)[0]"/>
                    -
                    <t t-esc="str(datetime.timedelta(hours=request['my_requests'].exchanged_timeslot_id.template_id.end_time)).rsplit(':', 1)[0]"/>
                  </td>
                  <td>
                    <t t-foreach="request['my_requests'].asked_timeslot_ids" t-as="asked_timeslot">
                      <t t-esc="asked_timeslot.date.strftime('%B %d, %Y')"/>
                      <t t-esc="'|'"/>
                      <t t-esc="str(datetime.timedelta(hours=asked_timeslot.template_id.start_time)).rsplit(':', 1)[0]"/>
                      -
                      <t t-esc="str(datetime.timedelta(hours=asked_timeslot.template_id.end_time)).rsplit(':', 1)[0]"/>
                      <br/>
                    </t>
                  </td>
                  <td>
                    <t t-if="request['my_requests'].status == 'has_match'">
                      <t t-foreach="request['matching_request']" t-as="match">
                        <b>Exchange offer :</b>
                        <br/>
                        <t t-esc="match.exchanged_timeslot_id.date.strftime('%B %d, %Y')"/>
                        <t t-esc="'|'"/>
                        <t t-esc="str(datetime.timedelta(hours=match.exchanged_timeslot_id.template_id.start_time)).rsplit(':', 1)[0]"/>
                        -
                        <t t-esc="str(datetime.timedelta(hours=match.exchanged_timeslot_id.template_id.end_time)).rsplit(':', 1)[0]"/>
                        <br/>
                        <a class="btn btn-success btn-sm" t-att-href="'/my/shift/validate/matching/validate/request/%i/%i' % (request['my_requests'],match)">Validate this exchange</a>
                        <br/>
                      </t>
                    </t>
                    <t t-elif="request['my_requests'].status == 'validate_match'">
                      Waiting for validation of the other cooperator.
                    </t>
                    <t t-elif="request['my_requests'].status == 'done'">
                      This exchange has been validated by both side.
                    </t>
                    <t t-else="">
                      No match has been found on your proposition.
                    </t>
                  </td>
                </tr>
              </t>
            </tbody>
          </table>
        </template>

        <template id="my_request" name="My Request">
            <t t-call="portal.portal_layout">
                <t t-set="no_breadcrumbs" t-value="True" />
                <div class="container mt16">
                    <div class="row">
                        <t t-call="beesdoo_website_shift_swap.my_request_template" />
                    </div>
                </div>
            </t>
        </template>



    </data>
</odoo>
